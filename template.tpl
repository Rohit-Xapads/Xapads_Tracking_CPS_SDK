___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Xapads Tracking CPS SDK",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Xapads",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Xapads Template for Google Tag Manager provides an easy way to integrate Xapads Attribution Pixel on your website.",
  "containerContexts": [
    "WEB"
  ],
  "categories": [
    "AFFILIATE_MARKETING",
    "CONVERSION_TRACKING",
    "ATTRIBUTION"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "advertiser_uid",
    "displayName": "Advertiser UID",
    "simpleValueType": true,
    "help": "Mandatory Macro - This is a unique identifier which you can get from Xapads.",
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "Please provide your Advertiser UID."
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "commission_amount",
    "displayName": "Commission Amount",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Mandatory Macro - This is a commission to Xapads (USD preferred)."
  },
  {
    "type": "TEXT",
    "name": "currency_code",
    "displayName": "Currency Code",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "[a-zA-Z]{3}"
        ],
        "errorMessage": "Please provide 3 characters currency code. e.g. USD, INR"
      }
    ],
    "help": "Mandatory Macro - This would be 3 characters currency code. e.g. USD, INR"
  },
  {
    "type": "TEXT",
    "name": "order_id",
    "displayName": "Order ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "Please enter the value."
      }
    ],
    "help": "Mandatory Macro - This will be your system Order Identifier (Order ID)."
  },
  {
    "type": "TEXT",
    "name": "sale_amount",
    "displayName": "Sale Amount",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "Please enter the value."
      }
    ],
    "help": "Mandatory Macro - This will be your sale amount Identifier (Sale Amount). Make sure Commission Amount \u0026 Sale Amount follow the same currency as passed in Currency Code."
  },
  {
    "type": "TEXT",
    "name": "country_code",
    "displayName": "Country Code",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "[a-zA-Z]{2}"
        ],
        "errorMessage": "Please provide 2 characters country code. e.g. US, IN"
      }
    ],
    "help": "Mandatory Macro - This would be 2 characters ISO code. e.g. US, IN"
  },
  {
    "type": "TEXT",
    "name": "product_type",
    "displayName": "Product Type",
    "simpleValueType": true,
    "help": "Optional - This will be required when commission varies with product type or type of user. For e.g., new/old type of user."
  },
  {
    "type": "TEXT",
    "name": "category",
    "displayName": "Category",
    "simpleValueType": true,
    "help": "Optional - This will be required when commission varies with category."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const queryPermission = require('queryPermission');
const getQueryParameters = require('getQueryParameters');
const sendPixel = require('sendPixel');
const encodeUriComponent = require('encodeUriComponent');
const logToConsole = require('logToConsole');

const pixelDomains = ["xapads63.gotrackier.com"];

logToConsole('data =', data);

let numCallbacks = pixelDomains.length;
let hasFailed = false;
const processAsync = (succeeded) => {
  if (hasFailed) {
    return;
  }

  if (succeeded) {
    numCallbacks--;
    if (numCallbacks === 0) {
      // Call data.gtmOnSuccess when the tag is finished.
      data.gtmOnSuccess();
    }
  } else {
    hasFailed = true;
    data.gtmOnFailure();
  }
};

let params = {
  'av': data.advertiser_uid,
  'goal_value': 'sale',
  'sale_amount': data.commission_amount,
  'currency': data.currency_code,
  'sub1': data.order_id,
  'sub2': data.sale_amount,
  'sub3': data.country_code,
  'sub4': data.product_type,
  'sub5': data.category
};

logToConsole('params =', params);

pixelDomains.forEach((domain) => {
  let paramsList = [];
  for (let p in params) {
    paramsList.push(encodeUriComponent(p.toString()) + "=" + encodeUriComponent(params[p].toString()));
  }

  const url = 'https://' + domain + '/pixel?' + paramsList.join("&");
  logToConsole('sendPixel #', ': ', url);
  sendPixel(url, () => processAsync(true), () => processAsync(false));
});


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://xapads63.gotrackier.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryKeys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "adid"
              }
            ]
          }
        },
        {
          "key": "query",
          "value": {
            "type": 8,
            "boolean": true
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 12/14/2021, 3:07:13 PM


